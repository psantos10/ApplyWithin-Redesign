<div class="container" id="main" style="margin-top:10px">

  <div class="row">
    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
      <div class="panel panel-default">
        <div class="panel-heading">
          <p><%= link_to "or for jobs?", positions_path, style:"color:#FF8D00;font-weight:600", class:"pull-right" %></p>
          <h4 class="" style=";margin-top:0px;color:#428bca;font-weight:600">Search businesses</h4>
        </div>
        
        <div class="panel-body">
          <%= form_tag businesses_path, :method => :get do %>
          <div class="form-group">
            <%= text_field_tag :q, params[:q], placeholder: "What?", class:"form-control", style:"width:81%;border-radius:4px" %>
          </div>
          <div class="form-group form-inline">
            <%= text_field_tag :location, params[:location], placeholder: "Where?", class:"form-control", style:"width:50%;border-radius:4px" %>
            <%= select_tag(:miles, options_for_select([1,2.5,5,10,15,20], selected: 2.5), options = {class:'form-control', style:'width:20%'})  %><label style="color:grey;margin-left:5px">miles</label>
          </div>
          <%= submit_tag "Search", :name => nil, class:"btn btn-success", style:"font-weight:600;border-radius:4px" %>
          <% end %>
        <%= link_to 'reset', businesses_path, class:"pull-right", style:"color:#428bca" %>
        </div>
      </div>
    </div>

    <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
      <div class="panel panel-default">
        <div class="panel-body">
          <div style='width:100%'>
            <div id="map" style='width:100%;height:350px;'></div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <h5 style="margin-top:0px;font-weight:600">Results:  <span style="font-style:italic;color:grey"><%= @businesses.count %>  <%= params[:q] %> <%= params[:location] %> </span></h5>
  <%= will_paginate @businesses %>

  <div class="row">
  <% @businesses.each do |business| %>
    <% if business.email.include?("colinbf") || business.email == nil %>

    <% elsif business.name.present? %>

      <div class="col-lg-3 col-md-3 col-sm-6 col-xs-10 ">
        <%= render partial: 'businesses/business', locals: {business: business} %>
      </div>

    <% end %>
  <% end %>

  </div>
</div>

<script type="text/javascript">
  handler = Gmaps.build('Google');
  handler.buildMap({ 
  	provider: { mapTypeId: google.maps.MapTypeId.ROADMAP, maxZoom: 16 }, 
  	internal: {id: 'map'}}, function(){
    markers = handler.addMarkers(<%=raw @hash.to_json %>);
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
  });
</script>
